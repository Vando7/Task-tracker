{% load static i18n %}
<div id="sidebarHolder">
  <button type="button" class="btn btn-dark" id="collapse-sidebar-button" title="Collapse sidebar">
    <i class="bi bi-arrow-bar-left"></i>
    <i class="bi bi-list"></i>
  </button>
  <div class="" id="mainSidebar">
    <div class="dropdown sidebar-element" id="userSidebarDropdown" style="margin-top:15px;">
        <a href="#" class="d-flex align-items-center link-body-emphasis text-decoration-none dropdown-toggle"
            data-bs-toggle="dropdown" id="userSidebarDropdownMenu" aria-expanded="false" style="display: flex;
                  justify-content: center;
                  align-items: center">
            {% if user.avatar %}
            <img src="{{ user.avatar.url }}" alt="Avatar" style="height: 32px;
                            width: 32px;
                            border-radius: 50%;
                            margin-right: 10px;" />
            {% else %}
            <img src="{% static 'images/default-avatar.png' %}" alt="Default Avatar" style="height: 32px;
                            width: 32px;
                            border-radius: 50%;
                            margin-right: 15px;" />
            {% endif %}
            <strong style="
              margin-top: 5px;
              font-size: 30px;
              white-space: nowrap;
              overflow: hidden;
              text-overflow: ellipsis;
              max-width: 100%;
            ">{{ user.name }}</strong>
        </a>
        <ul class="dropdown-menu text-small shadow">
          <li>
            <a class="dropdown-item" href="{% url 'home' %}">Home</a>
        </li>
            <li>
                <a class="dropdown-item" href="{% url 'task:workspaces' %}">Workspaces</a>
            </li>
            <li>
                <a class="dropdown-item" href="{% url 'users:detail' request.user.pk %}">Profile</a>
            </li>
            <li>
                <hr class="dropdown-divider" />
            </li>
            <li>
                <form method="post" action="{% url 'account_logout' %}">
                    {% csrf_token %}
                    <button type="dropdown-item" class="dropdown-item">Sign Out</button>
                </form>
            </li>
        </ul>
    </div>
    <hr class="sidebar-element" />
    <ul class="nav nav-pills flex-column mb-auto ps-0 sidebar-ul sidebar-element">
      <li class="nav-item">
          <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#NewTaskModal"
              style="width: 100%;border-radius:20px;margin-bottom:15px;"><i class="bi bi-plus-square-fill" style="font-size: 20px;margin-right:5px;"></i> New task
          </button>
      </li>
      {% for floor in request.session.sidebar_floors %}
      <div class="sidebar-floor-dropdown-container" style="margin-bottom:15px">
          <li class="nav-item" style="height:38px;">
              <div class="btn-group sidebar-floor-btn-group" style="filter: drop-shadow(0 0 0.35rem {{ floor.color }});">

                  <a href="{% url 'task:floor' floor.id %}"
                      class="btn sidebar-floor-button sidebar-btn-group-{{ floor.id }}"
                      style="background-color: {{ floor.color }}50;
                              border-color:{{ floor.color }}99;
                              {% if floor.id == floor_id %}
                              box-shadow:
                                0px 0px 4px black,
                                0px 0px 6px black,
                                0px 0px 8px {{ floor.color }};
                                0px 0px 10px {{ floor.color }};

                              {% endif %}
                              border-radius:20px;">
                      <strong>{{ floor.icon }} {{ floor.name }}</strong>
                  </a>

                  <a href="#collapsible-sidebar-{{ floor.id }}"
                      data-bs-target="collapsible-sidebar-{{ floor.id }}"
                      class="btn btn-primary sidebar-floor-expander sidebar-btn-group-{{ floor.id }}"
                      role="button"
                      aria-expanded="true"
                      aria-controls="collapsible-sidebar-{{ floor.id }}"
                      data-bs-toggle="collapse"
                      floor-id="{{ floor.id }}"
                      style="
                          background-color:{{ floor.color }}50;
                          border-color:{{ floor.color }}99;
                          border-radius:20px;
                          margin-left:5px;
                      ">
                      <i class="bi bi-chevron-up"></i>
                  </a>
                  <style>
                      .sidebar-btn-group-{{ floor.id }}{
                          transition: all 0.1s ease;
                      }

                      .sidebar-btn-group-{{ floor.id }}:hover {
                          filter: drop-shadow(0 0 0.75rem {{ floor.color }});
                          box-shadow:
                            0 0 5px black,
                            0 0 10px black;
                      }
                  </style>
              </div>
          </li>

          <div class="nav flex-column ms-3 collapse-sidebar collapse show"
              id="collapsible-sidebar-{{ floor.id }}">
              <ul style="display:block; padding-left:10px; margin-top:5px;" class="sidebar-ul">
                  {% for room in floor.rooms %}
                  <li class="nav-item">
                      <a href="{% url 'task:room' room.id %}"
                        class="nav-link sidebar-room-button"
                        style="color:#E0E0E0;
                          padding: 7 12 7 12;
                          margin: 5px;
                        {% if room.id == room_id %}
                          box-shadow:
                            0px 0px 3px black,
                            0px 0px 6px {{ floor.color }},
                            0px 0px 20px {{ floor.color }};

                        {% endif %}
                        "
                        >
                        {{ room.icon }} {{ room.name }}
                      </a>
                  </li>
                  {% endfor %}
              </ul>
          </div>
      </div>
      {% endfor %}
  </ul>
  </div>
</div>

<style>
    .sidebar {
      box-shadow: 10px 0 20px rgba(0, 0, 0, 0.5);
    }

    .sidebar-floor-expander {
        border-left: darkgrey solid 1px;
        width: 20%;
    }

    .sidebar-floor-button {
        width: 80%;
    }

    .sidebar-floor-btn-group {
        width: 100%;
    }

    .sidebar-ul {
        list-style-type: none;
    }

    .sidebar-room-button {
      transition: 0.1s;
      width: fit-content;
    }

    .sidebar-room-button:hover {
      box-shadow:
        0 0 10px black;
    }
</style>
