{% extends 'base.html' %}

{% load static i18n %}

{% block viewSpecificCss %}
  <link rel="stylesheet" href="{% static 'css/task_index.css' %}" />
</link />
{% endblock viewSpecificCss %}
{% block content %}
  <div class="column-cards" style="column-gap: 3rem;">
    {% for floor in workspace.floors.all %}
      <div class="card h-100 {{ floor.name|lower }}"
           style="break-inside: avoid;
                  margin-bottom: 3rem">
        <div class="card-header d-flex justify-content-between align-items-center"
             style="background-color: {{ floor.name }}">
          <h2 class="card-title">
            <a href="{% url 'task:floor_view' floor.id %}"
               style="text-decoration:none;
                      color:rgb(0, 0, 0)">{{ floor.name }}</a>
          </h2>
          <a href="{% url 'task:floor_view' floor.id %}" class="btn btn-lg">ðŸ‘€ View</a>
        </div>
        <div class="card-body" style="padding:0px;">
          {% for room in floor.rooms.all %}
            <div class="room-name-redirect"
                 style="padding:22px;
                        background-color:{% cycle 'white' floor.name %}">
              <h4 style="margin-bottom:0px;">
                <a href="{% url 'task:room_view' room.id %}"
                   class="room-link"
                   style="text-decoration: none">{{ room.name }}</a>
                {% if room.tasks > 0 %}<span class="badge bg-danger badge-sm">{{ room.tasks }}</span>{% endif %}
                {% if room.tasks > 0 %}<span class="badge bg-warning">{{ room.tasks }}</span>{% endif %}
                {% if room.tasks > 0 %}<span class="badge bg-success">{{ room.tasks }}</span>{% endif %}
              </h4>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>
  {% if user.avatar %}
    <img src="{{ user.avatar.url }}"
         alt="Avatar"
         style="height: 50px;
                width: 50px;
                border-radius: 50%" />
  {% else %}
    <img src="{% static 'images/default-avatar.png' %}"
         alt="Default Avatar"
         style="height: 50px;
                width: 50px;
                border-radius: 50%" />
  {% endif %}
  <p>Welcome, {{ user.name }}!</p>
  <h1>Welcome to the Task Index!</h1>
  <h2>Default Workspace: {{ default_workspace.name }}</h2>
  <h2>Selected Workspace: {{ workspace.name }}</h2>
  <!-- Form to Add Floor -->
  <form method="post" action="{% url 'task:add_floor' %}">
    {% csrf_token %}
    <input type="hidden" name="workspace_id" value="{{ workspace.id }}" />
    <input type="text" name="floor_name" placeholder="Floor Name" required />
    <button type="submit">Add Floor</button>
  </form>
  {% for floor in workspace.floors.all %}
    <div>
      <h4>Floor: {{ floor.name }}</h4>
      <form action="{% url 'task:remove_floor' floor.id %}"
            method="post"
            style="display:inline">
        {% csrf_token %}
        <a href="javascript:;" onclick="parentNode.submit();">Remove Floor</a>
      </form>
      <!-- Form to Add Room to this Floor -->
      <form method="post" action="{% url 'task:add_room' %}">
        {% csrf_token %}
        <input type="hidden" name="floor_id" value="{{ floor.id }}" />
        <input type="text" name="room_name" placeholder="Room Name" required />
        <button type="submit">Add Room</button>
      </form>
      {% for room in floor.rooms.all %}
        <h5>Room: {{ room.name }}</h5>
        <!-- Add the remove room form/button here -->
        <form method="post"
              action="{% url 'task:remove_room' room.id %}"
              style="display: inline">
          {% csrf_token %}
          <button type="submit"
                  onclick="return confirm('Are you sure you want to remove this room?');">Remove Room</button>
        </form>
        {% for task in room.tasks.all %}<p>Task: {{ task.task_name }}</p>{% endfor %}
      {% endfor %}
    </div>
  {% endfor %}
{% endblock content %}
